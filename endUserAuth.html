<html xmlns="http://www.w3.org/1999/xhtml">

    <head>
        <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
        <title>CLOUD VISION</title>

          // TODO: Update CSS_SHEET_FILENAME accordingly.
          <link rel="stylesheet" href="CSS_SHEET_FILENAME">
          <link href="https://fonts.googleapis.com/css?family=Montserrat&display=swap" rel="stylesheet">
          

    </head>

    <body>

    <pre id="output">
    <!-- OUTPUT MSG GOES HERE -->
    </pre>

    <script type="text/javascript">
      /** GLOBAL VARIABLES **/
      // TODO: Update global variables with your GCF auth credentials. 

      // The Browser API key obtained from the Google API Console.
      var API_KEY = 'YOUR_API_KEY';

      // The Client ID obtained from the Google API Console. Replace with your own Client ID.
      var CLIENT_ID = 'YOUR_CLIENT_ID';

      // Scope to use to access user's drive.
      var SCOPE = 'https://www.googleapis.com/auth/drive';

      // URL to your Google Cloud Function which will create a sheet.
      var GCF_URL = "YOUR_GCF_URL";
     
      // Do not change:
      var PICKER_API_LOADED = false;
      var OAUTH_TOKEN;
      var AUTH_PARAM = '';
      var FILE_ID = 'nothing';

    function createSheet(auth) {
            var auth = auth;https
            var functionEndpoint = GCF_URL;
            var data = {'auth': auth} 
            
            // Make 'POST' request to GCF.
            fetch(functionEndpoint, {
                  method: 'POST', 
                  body: JSON.stringify(data), 
                  headers:{
                        'Content-Type': 'application/json'
                    }
            }).then(res => {
                document.getElementById("output").innerHTML = "Made fetch request!";
                console.log("Response is: " + JSON.stringify(res));
            }); 
     }
    
    function initClient() {
      gapi.client.init({
        'apiKey': API_KEY,
        'clientId': CLIENT_ID,
        'scope': SCOPE,
        'discoveryDocs': ['https://sheets.googleapis.com/$discovery/rest?version=v4'],
      }).then(function() {
        gapi.auth2.getAuthInstance().isSignedIn.listen(updateSignInStatus);
        updateSignInStatus(gapi.auth2.getAuthInstance().isSignedIn.get());
        });
     }

    function handleClientLoad() {
      gapi.load('client:auth2', initClient);
    }

    function updateSignInStatus(isSignedIn) {
      if (isSignedIn) {
        //var googleUser = GoogleAuth.currentUser.get();
        var googleAuth = gapi.auth2.getAuthInstance();
        var googleUser = googleAuth.currentUser.get();
        var authParam = googleUser.getAuthResponse(true);
        authParam = authParam.access_token;
        //var authParam = googleUser.getAuthResponse;
        createSheet(authParam);
        console.log("Auth param is: " + authParam);
      }
    }

    function handleSignInClick(event) {
      gapi.auth2.getAuthInstance().signIn();
    }

    function handleSignOutClick(event) {
      gapi.auth2.getAuthInstance().signOut();
    }
    </script>
    
    <script async defer src="https://apis.google.com/js/api.js"
      onload="this.onload=function(){};handleClientLoad()"
      onreadystatechange="if (this.readyState === 'complete') this.onload()">   
    </script>

    // End-user prompt buttons. 
    <button id="signin-button" onclick="handleSignInClick()">Sign in</button>
    <button id="signout-button" onclick="handleSignOutClick()">Sign out</button>
    
  </body>
</html>